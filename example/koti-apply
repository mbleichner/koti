#!/usr/bin/python3 -B
#
# The -B flag disables bytecode compilation. Since koti needs to be run through sudo,
# the generated bytecode files will be owned by root and not your regular user, which
# can lead to annoying permission problems.
#
# In case you want to run a specific version of koti, you can specify it like this:
# import sys; sys.path.insert(0, "/path/to/my/specific/version/of/koti/src")

from socket import gethostname

from koti import *
from koti.managers.pacman import AurHelper, PaccacheOptions
from systems import dan, lenovo, mserver, quickemu

my_arch_systems = {
  "dan": dan(),  # .............. DAN A4-SFX desktop PC
  "lenovo": lenovo(),  # ........ Lenovo X13 laptop
  "mserver": mserver(),  # ...... Homelab server
  "archlinux": quickemu(),  # ... koti testing
}

koti = Koti(
  configs = my_arch_systems[gethostname()],  # ......... choose system config based on the current hostname
  managers = ArchPreset(  # ............................ use preconfigured default managers for Arch Linux
    PacmanPackageManager(
      aur_helper = AurHelper("paru", "manuel"),  # ..... but use paru instead of pacman to install packages
      keep_unmanaged_packages = False,  # .............. remove any packages that aren't mentioned in the koti config (this is the default)
      perform_update = True,  # ........................ always perform a full system update
      paccache = PaccacheOptions(enabled = True),  # ... clear the package cache using paccache (with default settings)
    ),
    FlatpakManager(
      perform_update = True,  # ........................ also perform a full flatpak update
    ),
  ),
)

koti.run(
  config_summary = True,  # ..... print a summary of all (enabled) config sections during planning phase
)
