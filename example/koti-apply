#!/usr/bin/python3 -B
#
# The -B flag disables bytecode compilation. Since koti needs to be run through sudo,
# the generated bytecode files will be owned by root and not your regular user, which
# can lead to annoying permission problems.
#
# In case you want to run a specific version of koti, you can specify it like this:
# import sys; sys.path.insert(0, "/path/to/my/specific/version/of/koti/src")

from socket import gethostname

from koti import *
from koti.utils import confirm
from systems import dan, lenovo, mserver

my_arch_systems = {
  "dan":     dan(),  # ...... DAN A4-SFX desktop PC
  "lenovo":  lenovo(),  # ... Lenovo X13 laptop
  "mserver": mserver(),  # .. Homelab server
}

koti = Koti(
  configs = my_arch_systems[gethostname()],  # ................. choose system config based on the current hostname
  managers = ConfigManagerPresets.arch(  # ..................... use preconfigured default managers for Arch Linux
    pacman_adapter = PacmanAdapter("sudo -u manuel paru"),  # .. but use paru instead of pacman
    keep_unmanaged_packages = False,  # ........................ remove any packages that aren't mentioned in the koti config (this is the default)
  ),
)

koti.plan()
confirm("confirm execution")
koti.apply()
print("execution finished.")
